{% extends 'base.html' %}

{% block title %}Главная{% endblock %}

{% block content %}
{% if birthdays %}
<div class="alert alert-info">
    <h5><i class="bi bi-balloon"></i> Сегодня день рождения у:</h5>
    <ul class="mb-0">
        {% for emp in birthdays %}
        <li>{{ emp.get_full_name }} ({{ emp.department.name }})</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% if holidays %}
<div class="alert alert-success">
    <h5><i class="bi bi-gift"></i> Сегодня праздник:</h5>
    <ul class="mb-0">
        {% for holiday in holidays %}
        <li>{{ holiday.name }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% if unread_transfers %}
<div class="alert alert-warning">
    <h5><i class="bi bi-bell"></i> Новые переводы:</h5>
    <ul class="mb-0">
        {% for transfer in unread_transfers %}
        <li>
            <strong>{{ transfer.from_employee.get_full_name }}</strong> перевел(а) вам 
            <strong>{{ transfer.amount }} ₽</strong> 
            <small>({{ transfer.created_at|date:"d.m.Y H:i" }})</small>
            <br><em>{{ transfer.review|truncatewords:10 }}</em>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="row">
    <!-- Левая колонка - Новости -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-newspaper"></i> Новости</h5>
            </div>
            <div class="card-body">
                {% if news %}
                    {% for item in news %}
                    <div class="mb-3 pb-3 border-bottom">
                        <h6>{{ item.title }}</h6>
                        <p class="text-muted small">{{ item.content|truncatewords:20 }}</p>
                        <small class="text-muted">{{ item.created_at|date:"d.m.Y H:i" }}</small>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">Новостей пока нет</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Центральная колонка - Рейтинг -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-trophy"></i> Рейтинг за текущий месяц</h5>
            </div>
            <div class="card-body">
                {% if rating %}
                    <ol class="list-group list-group-numbered">
                        {% for emp in rating %}
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">{{ emp.get_full_name }}</div>
                                <small class="text-muted">{% if emp.department %}{{ emp.department.name }}{% else %}-{% endif %}</small>
                            </div>
                            <span class="badge bg-primary rounded-pill">{{ emp.total_received|floatformat:2 }} ₽</span>
                        </li>
                        {% endfor %}
                    </ol>
                {% else %}
                    <p class="text-muted">Рейтинг пока пуст</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Правая колонка - Новые отзывы -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-chat-dots"></i> Новые отзывы</h5>
            </div>
            <div class="card-body">
                {% if recent_reviews %}
                    {% for review in recent_reviews %}
                    <div class="mb-3 pb-3 border-bottom">
                        <div class="d-flex justify-content-between">
                            <strong>{{ review.from_employee.get_full_name }}</strong>
                            <small class="text-muted">{{ review.created_at|date:"d.m.Y" }}</small>
                        </div>
                        <p class="mb-1"><small>→ {{ review.to_employee.get_full_name }}</small></p>
                        <p class="text-muted small">{{ review.review|truncatewords:15 }}</p>
                        <span class="badge bg-success">{{ review.amount }} ₽</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">Отзывов пока нет</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

